<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0"/>
    <link rel="stylesheet" href="style.css"/>
    <title>Team List</title>
</head>
<body>
<ul id="teamlist">
</ul>

<script type="text/javascript" src="../platform/cobalt.js"></script>
<script type="text/javascript" src="app.js"></script>
<script>

var actionsBar = {
        "visible": { "top" : true },
        "backgroundColor": "#FF4444",
        "color": "FFF",
        "title": "Rename or delete a mate",                   
        "actions": [
            {
                "name": "delete",
                "icon" : "fa fa-trash",
                "title" : "Remove",
                "backgroundColor": "#FF4444",
                "color": "FFF",
                "iosPosition": "topRight",
                "androidPosition": "top"
            },
            {
                "name": "rename",
                "icon" : "fa fa-check",
                "title" : "Rename",
                "backgroundColor": "#FF4444",
                "color": "FFF",
                "iosPosition": "topRight",
                "androidPosition": "top"
            },
        ]
    };
    var addBar = {
            "visible": { "top" : true },
            "backgroundColor": "#FF4444",
            "color": "FFF",
            "title": "add a mate",                   
            "actions": [
                {
                    "name": "add",
                    "icon" : "fa fa-check",
                    "title" : "Add",
                    "backgroundColor": "#FF4444",
                    "color": "FFF",
                    "iosPosition": "topRight",
                    "androidPosition": "top"
                }
            ]
        };


    

    function showForm(){
            //cobalt.storage.set('selectedMate', { id: this.id, name: this.innerHTML });
            //cobalt.webLayer("show","team_actions.html");
            cobalt.navigate.push({ page : "team_actions.html", data :{ people :  { id: this.id, name: this.innerHTML } }, bars : actionsBar });
        }

    function displayList(){

        var peoples = app.getPeoples();
        cobalt.log(peoples);
        if (typeof peoples == 'undefined') {
            peoples = [];
        }

        if (peoples.length==0){
            cobalt.toast("no member found, please use 'plus' button in header");
        }
        

        var teamList = document.getElementById("teamlist");
        teamList.innerHTML = ''; //clean

        peoples.forEach(function(people) {
          var li = document.createElement("li");
          li.id = people.id;
          li.onclick = showForm;
          li.innerHTML = people.name;
          teamList.appendChild(li);
        });


    }




    document.addEventListener("DOMContentLoaded", function() {

        cobalt.init({
            debug: true,
            //debugInBrowser:true,
            events: {
                onPageShown: function (data, callback) {
                    cobalt.log('Display Team List...');
                    init();
                    displayList();
                },
                //called after rename or delete event
                // onWebLayerDismissed : function( data, callback ){
                //     init();
                //     displayList();
                // }
            }
        });

        function init(){
            cobalt.nativeBars.setActionVisible("team_add", true);
            cobalt.nativeBars.setActionVisible("team_list", false);
            cobalt.nativeBars.setBarContent({
                "title": "Team List"
            });

        }
           

        
        

        cobalt.nativeBars.setEventListener(function (item, event) {
            switch (item) {
                case "team_add":
                    cobalt.navigate.push({ page : "team_add.html",  bars : addBar });
                    break;
                default :
                    cobalt.log('An unknown button has been pressed.');
                    break;
            }
        });

        

        //cobalt.events.onPageShown();
        //displayList();



    });

</script>
</body>
</html>
